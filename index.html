<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebRTC Game Receiver</title>
  <style>
    html,body { height:100%; margin:0; background:black; }
    #stream { width:100%; height:100%; object-fit:contain; background:black; }
    #status { position: absolute; top: 8px; left:8px; color:#0f0; font-family:monospace; }
  </style>
</head>
<body>
  <div id="status">connecting...</div>
  <video id="stream" autoplay playsinline muted></video>

<script>
const SIGNALING_URL = "ws://YOUR_PC_IP:8080"; // <-- change to your signaling server
const pcConfig = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };

const videoEl = document.getElementById('stream');
const statusEl = document.getElementById('status');
let pc = null;
let ws = null;

function log(s){ console.log(s); statusEl.textContent = s; }

function connectSignaling() {
  ws = new WebSocket(SIGNALING_URL);
  ws.onopen = () => log("signaling connected");
  ws.onerror = (e) => { console.error("ws err", e); log("signaling error"); };
  ws.onclose = () => log("signaling closed");
  ws.onmessage = async (evt) => {
    let msg = null;
    try { msg = JSON.parse(evt.data); } catch(e) { console.warn("bad msg", e); return; }

    if (msg.type === 'offer') {
      await handleOffer(msg.sdp);
    } else if (msg.type === 'ice') {
      if (pc && msg.candidate) {
        try { await pc.addIceCandidate(msg.candidate); } catch(e){ console.warn(e); }
      }
    }
  };
}

async function handleOffer(offerSdp) {
  log("received offer, creating PeerConnection...");
  pc = new RTCPeerConnection(pcConfig);

  pc.ontrack = (ev) => {
    log("track received");
    videoEl.srcObject = ev.streams[0];
  };

  pc.onicecandidate = (e) => {
    if (e.candidate && ws && ws.readyState === 1) {
      ws.send(JSON.stringify({ type: 'ice', candidate: e.candidate }));
    }
  };

  await pc.setRemoteDescription({ type: 'offer', sdp: offerSdp });

  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);

  // send answer
  ws.send(JSON.stringify({ type: 'answer', sdp: pc.localDescription.sdp }));
  log("answer sent; waiting for media...");
}

// small UI to show latency-ready
connectSignaling();
</script>
</body>
</html>
